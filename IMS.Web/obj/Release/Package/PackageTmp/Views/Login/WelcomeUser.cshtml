@model IMS.Models.IMS_Users
@{

    string userEmail = ViewBag.UserEmail;

}
<style>
    .navbar {
        display: none;
    }

    .container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
    }   

    #swal2-content {
        font-size: 17px;
    }

    #swal2-title {
        font-size: 15px;
    }

    .btn-submit1 {
        margin-left: -14px;
        display: inline;
        border-radius: 5px;
        border: 1px solid transparent;
        background: #eb616b;
        display: block;
        letter-spacing: 0.5px;
        color: #fff;
        font-size: 15px;
    }

        .btn-submit1:hover {
            border: 1px solid transparent;
            background: #e63946;
            color: #fff;
        }

    swal2-confirm swal2-styled {
        color: #fff !important;
        background: #e63946;
        border: 1px solid #e63946;
    }
</style>
<link href="~/Content/sweetalert2.min.css" rel="stylesheet" />
<link href="~/assets/css/custom.css" rel="stylesheet" />
<body class="body-style">
    <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
         data-sidebar-position="fixed" data-header-position="fixed">
        <div class="row">
            <input type="hidden" value="@userEmail" id="userEmail" name="userEmail" />

            <div class="col-lg-6">
                <div class="welcome-div">
                    <div class="brand-logo d-flex align-items-center justify-content-between logo-div">
                        <a href="./index.html" class="text-nowrap logo-img border-0">
                            <img src="~/Images/harbinger_new_logo_white.png" alt="" />
                        </a>
                        <a class="sidebar-link border-start ms-4 vertical-line" href="./index.html" aria-expanded="false">
                            <img src="~/assets/images/logos/IMS-logo-white.png" alt="" />
                        </a>
                        <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
                            <i class="ti ti-x fs-8"></i>
                        </div>


                    </div>
                    <h4 class="text-start welcome-text">Welcome!  @userEmail </h4> 
                    <a href="#" type="submit" value="Welcome" id="btn_submit" onclick="getDesignation(this)" name="submit"
                       class="btn btn-primary wlink getStartedBtn text-white "
                       data-toggle="modal" data-target=".bs-example-modal-lg">Get Started</a>

                    @Html.Hidden("RedirectTo", Url.Action("Index", "Dashboard"))


                </div>
            </div>
            <div class="col-lg-6">
                <img src="~/assets/images/backgrounds/welcome-user.png" class="img-fluid welcome-image" />

            </div>

            @*<a href="#" type="submit" value="Welcome" id="btn_submit" onclick="getDesignation(this)" name="submit" class="btn btn-default wlink" data-toggle="modal" data-target=".bs-example-modal-lg">Click here to proceed</a>*@

            @Html.Hidden("RedirectTo", Url.Action("Index", "Dashboard"))

        </div>
        <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Select Role:</h4>
                    </div>
                    <div class="modal-body" style="height:20rem">
                        @using (Html.BeginForm("Login", "Login", FormMethod.Post))
                        {

                            <div class="form-group">

                                <div class="col-md-10">
                                    <label>Please Select Designation</label><br />

                                    @Html.DropDownList("designation", new SelectList(ViewBag.designation, "userDepartmentId", "RoleInIMS"), "Select", new { @class = "form-control input-col", @id = "designation", @required = "required" })



                                    <input type="hidden" value="@userEmail" id="userEmail" name="userEmail" />
                                    <input type="hidden" value="" id="user_department" name="user_department" />
                                    <input type="hidden" value="" id="userLocation" name="userLocation" />
                                    <input type="hidden" value="" id="RoleInIMS" name="RoleInIMS" />
                                    <input type="hidden" value="" id="userDepartmentId" name="userDepartmentId" />

                                    <br /><br />
                                    <div class="col-md-10">
                                        <button type="submit" id="modal_submit" class="btn btn-default btn-submit1 button button4">Submit</button>

                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script src="~/Scripts/sweetalert2.all.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</body>

<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery-3.3.1.js"></script>

@section Scripts{
    <script type="text/javascript">
     let isims = false;

     $(document).ready(function () {
         //   window.history.go(-1);
         function preventBack() { window.history.forward(); }
         setTimeout(preventBack(), 0);
         window.onunload = function () { null };


         var userEmail;
         $('#modal_submit').click(function (e) {
             debugger;
             var selectedText = $("#designation").find("option:selected").text();
             var selectedval = $("#designation").find("option:selected").val();
             var temp = new Array();
             temp = selectedText.split("-");
             document.getElementById('user_department').value = temp[1];
             userEmail = $('#Email').val();
             document.getElementById('userEmail').value = userEmail;
             document.getElementById('RoleInIMS').value = temp[0];
             document.getElementById('userLocation').value = temp[2];
             document.getElementById('userDepartmentId').value = selectedval;
         });



         @*$('#btn_submit').click(function (e) {
             e.preventDefault();
             userEmail = $('#userEmail').val();


             $('.error').hide();
             $.ajax({
                 url: '@Url.Action("GetDesignationCount")',
                 method: "GET",
                 data: { Email: userEmail },
                 success: function (data) {
                     debugger;
                     data = JSON.parse(data);
                     console.log(data);
                     if (data != 0) {
                         debugger
                         //alert(data);
                         $('#myModal').modal('show');
                     }

                     else {
                         $('#myModal').modal('hide');
                         //var url = $("#RedirectTo").val();
                         //location.href = url;
                         // alert(data);
                         var url = $("#RedirectTo").val();
                         location.href = url;
                         //$("#loginform").submit();
                     }
                 }
             });

         });*@

        });

        function getDesignation(_this)
    {
        debugger;
        $('#designation').empty();
        $('#designation').prop("disabled", false);

        var userEmail = $('#userEmail').val();

                  $.ajax({
                  url: '@Url.Action("GetRolesdata")',
                  method: "GET",
                  data: { Email: userEmail },
                  success: function (data) {
                      debugger;
                        data = JSON.parse(data);
                        console.log(data);

                        var optionhtml = '<option value="' + 0 + '">' + "Select" + '</option>';
                             $("#designation").append(optionhtml);
                      $.each(data, function (i) {
                          var optionhtml1 = '<option value="' +
                              data[i].userDepartmentId + '">' + data[i].RoleInIMS + "-" + data[i].userDepartmentName + "-" + data[i].userLocation + '</option>';

                          $("#designation").append(optionhtml1);
                      });
                    },
                    error: function (err) { console.error(err) }

                })

        }


    @*function getDesignation(_this)
    {
        debugger;
        $('#designation').empty();
        $('#designation').prop("disabled", false);

        var userEmail = $('#userEmail').val();

                  $.ajax({
                  url: '@Url.Action("GetDesignationdata")',
                  method: "GET",
                  data: { Email: userEmail },
                  success: function (data) {
                      debugger;
                        data = JSON.parse(data);
                        console.log(data);

                        var optionhtml = '<option value="' +
                            0 + '">' + "Select" + '</option>';
                        $("#designation").append(optionhtml);

                        var duplicate_designation = new Array();
                        var designation_array = new Array();

                        var count = 0;

                      $.each(data, function (i) {
                          debugger
                          if (userEmail.toLowerCase() == data[i].userEmail.toLowerCase()) {
                              debugger;
                                  designation_array[count] = data[i].RoleInIMS;
                                  count++;
                           }
                        });

                      $.each(data, function (i) {
                            if (userEmail.toLowerCase() == data[i].userEmail.toLowerCase())
                            {
                                var designation_count;

                                designation_count = search(designation_array, data[i].RoleInIMS);
                                if (designation_count > 1) {
                                    var optionhtml1 = '<option value="' +
                                        data[i].userDepartmentId + '">' + data[i].RoleInIMS + "-" + data[i].userDepartmentName + '</option>';

                                    $("#designation").append(optionhtml1);
                                }
                                else {
                                    var optionhtml1 = '<option value="' +
                                        data[i].userDepartmentId + '">' + data[i].RoleInIMS + '</option>';

                                    $("#designation").append(optionhtml1);
                                }


                            }

                        });

                    },
                    error: function (err) { console.error(err) }

                })

        }*@

        function search(arr, x) {
            debugger;
            var item_search_count = 0;

            for (var i = 0; i < arr.length; i++) {
                if (arr[i] == x) {
                    item_search_count++;
                }
            }
            return item_search_count;
        }
    </script>

}
